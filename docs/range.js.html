<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>range.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Array.html">Array</a><ul class='methods'><li data-type='method'><a href="Array.html#empty">empty</a></li><li data-type='method'><a href="Array.html#first">first</a></li><li data-type='method'><a href="Array.html#isLast">isLast</a></li><li data-type='method'><a href="Array.html#last">last</a></li></ul></li><li><a href="Date.html">Date</a><ul class='methods'><li data-type='method'><a href="Date.html#.format">format</a></li><li data-type='method'><a href="Date.html#.formatLength">formatLength</a></li><li data-type='method'><a href="Date.html#.sameDay">sameDay</a></li><li data-type='method'><a href="Date.html#addDays">addDays</a></li><li data-type='method'><a href="Date.html#addHours">addHours</a></li><li data-type='method'><a href="Date.html#addMillis">addMillis</a></li><li data-type='method'><a href="Date.html#addMinutes">addMinutes</a></li><li data-type='method'><a href="Date.html#addMonths">addMonths</a></li><li data-type='method'><a href="Date.html#addSeconds">addSeconds</a></li><li data-type='method'><a href="Date.html#addYears">addYears</a></li><li data-type='method'><a href="Date.html#diff">diff</a></li><li data-type='method'><a href="Date.html#earlierDayThan">earlierDayThan</a></li><li data-type='method'><a href="Date.html#format">format</a></li><li data-type='method'><a href="Date.html#incDay">incDay</a></li><li data-type='method'><a href="Date.html#incHour">incHour</a></li><li data-type='method'><a href="Date.html#incMilli">incMilli</a></li><li data-type='method'><a href="Date.html#incMinute">incMinute</a></li><li data-type='method'><a href="Date.html#incMonth">incMonth</a></li><li data-type='method'><a href="Date.html#incSecond">incSecond</a></li><li data-type='method'><a href="Date.html#incYear">incYear</a></li><li data-type='method'><a href="Date.html#laterDayThan">laterDayThan</a></li><li data-type='method'><a href="Date.html#sameDay">sameDay</a></li><li data-type='method'><a href="Date.html#toUtc">toUtc</a></li><li data-type='method'><a href="Date.html#truncTime">truncTime</a></li></ul></li><li><a href="module-@crabel_shared_csv-CsvReader.html">CsvReader</a><ul class='methods'><li data-type='method'><a href="module-@crabel_shared_csv-CsvReader.html#toString">toString</a></li></ul></li><li><a href="module-@crabel_shared_range-ArrayRange.html">ArrayRange</a></li><li><a href="module-@crabel_shared_range-Range.html">Range</a><ul class='methods'><li data-type='method'><a href="module-@crabel_shared_range-Range.html#add">add</a></li><li data-type='method'><a href="module-@crabel_shared_range-Range.html#clear">clear</a></li><li data-type='method'><a href="module-@crabel_shared_range-Range.html#combine">combine</a></li><li data-type='method'><a href="module-@crabel_shared_range-Range.html#empty">empty</a></li><li data-type='method'><a href="module-@crabel_shared_range-Range.html#exclude">exclude</a></li><li data-type='method'><a href="module-@crabel_shared_range-Range.html#forEach">forEach</a></li><li data-type='method'><a href="module-@crabel_shared_range-Range.html#from">from</a></li><li data-type='method'><a href="module-@crabel_shared_range-Range.html#inRange">inRange</a></li><li data-type='method'><a href="module-@crabel_shared_range-Range.html#intervalFromArray">intervalFromArray</a></li><li data-type='method'><a href="module-@crabel_shared_range-Range.html#same">same</a></li><li data-type='method'><a href="module-@crabel_shared_range-Range.html#subtract">subtract</a></li><li data-type='method'><a href="module-@crabel_shared_range-Range.html#to">to</a></li><li data-type='method'><a href="module-@crabel_shared_range-Range.html#toString">toString</a></li><li data-type='method'><a href="module-@crabel_shared_range-Range.html#validInterval">validInterval</a></li></ul></li><li><a href="Number.html">Number</a><ul class='methods'><li data-type='method'><a href="Number.html#between">between</a></li><li data-type='method'><a href="Number.html#nextPow2">nextPow2</a></li><li data-type='method'><a href="Number.html#prevPow2">prevPow2</a></li><li data-type='method'><a href="Number.html#roundToInt">roundToInt</a></li><li data-type='method'><a href="Number.html#toEnum">toEnum</a></li><li data-type='method'><a href="Number.html#toTime">toTime</a></li><li data-type='method'><a href="Number.html#truncToInt">truncToInt</a></li><li data-type='method'><a href="Number.html#zeroPadd">zeroPadd</a></li></ul></li><li><a href="Object.html">Object</a><ul class='methods'><li data-type='method'><a href="Object.html#.className">className</a></li><li data-type='method'><a href="Object.html#.contains">contains</a></li><li data-type='method'><a href="Object.html#.copy">copy</a></li><li data-type='method'><a href="Object.html#.isPrimitive">isPrimitive</a></li><li data-type='method'><a href="Object.html#.isType">isType</a></li><li data-type='method'><a href="Object.html#className">className</a></li><li data-type='method'><a href="Object.html#clone">clone</a></li><li data-type='method'><a href="Object.html#contains">contains</a></li><li data-type='method'><a href="Object.html#is">is</a></li><li data-type='method'><a href="Object.html#isPrimitive">isPrimitive</a></li><li data-type='method'><a href="Object.html#merge">merge</a></li></ul></li><li><a href="StringList.html">StringList</a><ul class='methods'><li data-type='method'><a href="StringList.html#clear">clear</a></li><li data-type='method'><a href="StringList.html#count">count</a></li><li data-type='method'><a href="StringList.html#empty">empty</a></li><li data-type='method'><a href="StringList.html#forEach">forEach</a></li><li data-type='method'><a href="StringList.html#line">line</a></li><li data-type='method'><a href="StringList.html#load">load</a></li><li data-type='method'><a href="StringList.html#merge">merge</a></li><li data-type='method'><a href="StringList.html#newLine">newLine</a></li><li data-type='method'><a href="StringList.html#remove">remove</a></li><li data-type='method'><a href="StringList.html#save">save</a></li><li data-type='method'><a href="StringList.html#toString">toString</a></li><li data-type='method'><a href="StringList.html#write">write</a></li><li data-type='method'><a href="StringList.html#writeLine">writeLine</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="index.module_js.html">js</a></li><li><a href="module-@crabel_shared_csv.html">@crabel/shared/csv</a><ul class='methods'><li data-type='method'><a href="module-@crabel_shared_csv.html#~csvToArray">csvToArray</a></li></ul></li><li><a href="module-@crabel_shared_fs_util.html">@crabel/shared/fs_util</a><ul class='methods'><li data-type='method'><a href="module-@crabel_shared_fs_util.html#.addExt">addExt</a></li><li data-type='method'><a href="module-@crabel_shared_fs_util.html#.copy">copy</a></li><li data-type='method'><a href="module-@crabel_shared_fs_util.html#.ensurePath">ensurePath</a></li><li data-type='method'><a href="module-@crabel_shared_fs_util.html#.erase">erase</a></li><li data-type='method'><a href="module-@crabel_shared_fs_util.html#.loadText">loadText</a></li><li data-type='method'><a href="module-@crabel_shared_fs_util.html#.makeUnique">makeUnique</a></li><li data-type='method'><a href="module-@crabel_shared_fs_util.html#.move">move</a></li><li data-type='method'><a href="module-@crabel_shared_fs_util.html#.removeExt">removeExt</a></li><li data-type='method'><a href="module-@crabel_shared_fs_util.html#.saveText">saveText</a></li><li data-type='method'><a href="module-@crabel_shared_fs_util.html#.swapExt">swapExt</a></li></ul></li><li><a href="module-@crabel_shared_proto.html">@crabel/shared/proto</a><ul class='methods'><li data-type='method'><a href="module-@crabel_shared_proto.html#.init">init</a></li></ul></li><li><a href="module-@crabel_shared_range.html">@crabel/shared/range</a></li><li><a href="module-@crabel_shared_str_util.html">@crabel/shared/str_util</a><ul class='methods'><li data-type='method'><a href="module-@crabel_shared_str_util.html#.align">align</a></li><li data-type='method'><a href="module-@crabel_shared_str_util.html#.alignC">alignC</a></li><li data-type='method'><a href="module-@crabel_shared_str_util.html#.alignL">alignL</a></li><li data-type='method'><a href="module-@crabel_shared_str_util.html#.alignR">alignR</a></li><li data-type='method'><a href="module-@crabel_shared_str_util.html#.buildTable">buildTable</a></li><li data-type='method'><a href="module-@crabel_shared_str_util.html#.capitalize">capitalize</a></li><li data-type='method'><a href="module-@crabel_shared_str_util.html#.combineLines">combineLines</a></li><li data-type='method'><a href="module-@crabel_shared_str_util.html#.crc32">crc32</a></li><li data-type='method'><a href="module-@crabel_shared_str_util.html#.decapitalize">decapitalize</a></li><li data-type='method'><a href="module-@crabel_shared_str_util.html#.expand">expand</a></li><li data-type='method'><a href="module-@crabel_shared_str_util.html#.fill">fill</a></li><li data-type='method'><a href="module-@crabel_shared_str_util.html#.format">format</a></li><li data-type='method'><a href="module-@crabel_shared_str_util.html#.formatError">formatError</a></li><li data-type='method'><a href="module-@crabel_shared_str_util.html#.indent">indent</a></li><li data-type='method'><a href="module-@crabel_shared_str_util.html#.splitLines">splitLines</a></li><li data-type='method'><a href="module-@crabel_shared_str_util.html#.substDate">substDate</a></li><li data-type='method'><a href="module-@crabel_shared_str_util.html#.substEnv">substEnv</a></li><li data-type='method'><a href="module-@crabel_shared_str_util.html#.substProp">substProp</a></li><li data-type='method'><a href="module-@crabel_shared_str_util.html#.toObject">toObject</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">range.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Encapsulates list of non overlapping intervals. The interval object can be any object,
 * the extraction functions must be specified, these function return a comparable value
 * such as a string or a number. Specialized "Range' classes can be defined by providing
 * extraction function for the specific object type. The class RangeArray is an example of
 * how Range specialization.
 * @module @crabel/shared/range
 * @author: Carlos Galavis &lt;cgalavis@crabel.com>
 */
'use strict';

require("./proto");
let util = require("util");

// Creates an instance of 'DateRage' given two values
/**
 * The range object supports range style operations on any number of intervals. The
 * constructor takes two parameters each represent the property names of the two ends of
 * an interval object. Any object can be used as an interval as long as it supports these
 * two properties.
 * @param {string} p_from Name of the property that holds the left side of an interval.
 * @param {string} p_to Name of the property that holds the right side of the interval.
 * @constructor
 */
function Range(p_from, p_to) {
    if (undefined === p_from || undefined === p_to)
        throw new Error("Valid properties for 'from' and 'to' most be defined for the " +
            "new 'Range'");

    this.fromProp = p_from;
    this.toProp = p_to;
    this.intervals = [];
    let that = this;

    Object.defineProperty(this, "length", {
        get: function () {
            return that.intervals.length;
        },
        set: function (nvalue) {
            that.intervals.length = nvalue;
        }
    });
}

/**
 * Call this function to determine if the range is empty i.e. has no intervals.
 * @returns {boolean} True if the range has no intervals, false otherwise.
 */
Range.prototype.empty = function () {
    return this.intervals.empty();
};

/**
 * Returns the left side value of the n interval.
 * @param index Index of the interval.
 * @returns {number} Value of the left side of the range.
 */
Range.prototype.from = function (index) {
    if (index &lt; 0 || index >= this.intervals.length)
        throw new Error("Invalid call to 'Range.from', the index is out of bounds.");

    return this.intervals[index][this.fromProp];
};

/**
 * Call this function to determine if the range is empty i.e. has no intervals.
 * @param index Index of the interval.
 * @returns {number} Value of the right side of the range
 */
Range.prototype.to = function (index) {
    if (index &lt; 0 || index >= this.intervals.length)
        throw new Error("Invalid call to 'Range.to', the index is out of bounds.");

    return this.intervals[index][this.toProp];
};

/**
 * Converts the range to a JSON style string.
 * @returns {string} JSON string.
 */
Range.prototype.toString = function () {
    if (this.intervals.empty())
        return "(empty)";

    let res = "[ (" + this.from(0) + "," + this.to(0) + ")";

    for (let i = 1; i &lt; this.intervals.length; ++i)
        res += ", (" + this.from(i) + "," + this.to(i) + ")";

    return res + " ]";
};

/**
 * Determines whether the value or interval is in the range. The parameters can be a
 * number, interval object or array of two values (from/to).
 * @param {number|interval|array} it Section to test for inclusion in the range.
 * @returns {boolean} True if the parameter is within the range.
 */
Range.prototype.inRange = function (it) {
    let from, to;
    if (1 == arguments.length) {
        if (isNaN(arguments[0])){
            let int = arguments[0];
            if (int.is(Array)) {
                from = int[0];
                to = int[1];
            }
            else {
                from = int[this.fromProp];
                to = int[this.toProp];
            }
        }
        else
            from = to = Number(arguments[0]);
    }
    else {
        from = arguments[0];
        to = arguments[1];
    }

    if (undefined === from || undefined === to)
        throw new Error("Invalid call to 'Range.inRange', the arguments must include " +
            "a valid interval.");

    for (let i = 0; i &lt; this.intervals.length; ++i) {
        if (from > to[i])
            break;

        if (this.from(i) &lt;= from &amp;&amp; this.to(i) >= to)
            return true;
    }

    return false;
};

/**
 * Iterate through the intervals in the range calling 'iter_func' for every interval.
 * Iteration is interrupted when all items have been called, or when 'iter_func' returns
 * true indicating that is done.
 * @param {function} iter_func Callback function. Receives the &lt;b>interval&lt;/b>,
 * &lt;b>index&lt;/b&lt; and &lt;b>range&lt;/b> object by parameter.
 * */
Range.prototype.forEach = function (iter_func) {
    for (let i = 0; i &lt; this.length; ++i) {
        if (iter_func(this.intervals[i], i, this))
            break;
    }
};

/**
 * Validates the given interval. If &lt;b>array&lt;/b> it must have 2 elements and the forst
 * must be less or equal to the seconds. If &lt;b>object&lt;/b> it must support the two interval
 * properties defined in the range and the left side (from) must be less or equal to the
 * right side (to). This function is used by other methods to verify the validity of input
 * parameters.
 * @param int Interval object or array with two elements.
 * @returns {boolean} True if the interval is valid.
 */
Range.prototype.validInterval = function (int) {
    if (int.is(Array))
        return 2 &lt;= int.length &amp;&amp; int[0] &lt;= int[1];

    return (
        undefined !== int[this.fromProp] &amp;&amp;
        undefined !== int[this.toProp] &amp;&amp;
        int[this.fromProp] &lt;= int[this.toProp]
    );
};

/**
 * Builds an interval object from the given array. The &lt;b>from&lt;/b> and &lt;b>to&lt;/b>
 * properties are set from the first two elements of the array.
 * @param aint
 * @returns {{}}
 */
Range.prototype.intervalFromArray = function (aint) {
    if (!this.validInterval(aint))
        throw new Error("The interval passed to 'intervalFromArray' is not valid.");

    let res = {};
    res[this.fromProp] = aint[0];
    res[this.toProp] = aint[1];

    return res;
};

/**
 * Removes all the intervals in the range.
 */
Range.prototype.clear = function () {
    this.intervals.length = 0;
};

/**
 * Adds the given interval to the range merging overlapping intervals. This methods allows
 * arrays and interval objects to be passed by parameter. Multiple intervals can be passed
 * in one call. If two numbers are passed, they are used to build a single interval.
 * @param {*} int Interval object or array.
 * @returns {Range} Returns the range to allow method chaining.
 */
Range.prototype.add = function (nint) {
    if (2 == arguments.length &amp;&amp; !isNaN(arguments[0]) &amp;&amp; !isNaN(arguments[1])) {
        this.add([arguments[0], arguments[1]]);
        return this;
    }

    if (1 &lt; arguments.length) {
        for (let ai = 0; ai &lt; arguments.length; ++ai)
            this.add(arguments[ai]);
        return this;
    }

    if (nint.is(Array))
        nint = this.intervalFromArray(nint);

    if (!this.validInterval(nint))
        throw new Error("An invalid interval '" + nint.toJSONEx() + "' was passed to " +
            "the 'add' method.");

    let from = nint[this.fromProp];
    let to = nint[this.toProp];

    // Avoid adding empty intervals
    if (from == to)
        return this;;

    for (let i = 0; i &lt; this.length; ++i) {
        if (from &lt;= this.to(i)) {
            // no overlap, nint is before the current interval
            if (to &lt; this.from(i)) {
                this.intervals.splice(i, 0, nint);
                return this;
            }

            // partial left overlap
            if (to &lt;= this.to(i)) {
                this.intervals[i][0] = nint[0];
                return this;
            }

            // right overlap or potentially multi-overlap
            if (this.from(i) &lt; nint[this.fromProp])
                nint[this.fromProp] = this.from(i);
            this.intervals.splice(i, 1);
            this.add(nint);
            return this;
        }

    }   // for

    this.intervals.push(nint);
    return this;
};

/**
 * Subtracts the given interval from the range splitting intervals when needed. This
 * methods allows arrays and interval objects to be passed by parameter. Multiple
 * intervals can be passed in one call. If two numbers are passed, they are used to build
 * a single interval.
 * @param {*} int Interval object or array.
 * @returns {Range} Returns the range to allow method chaining.
 */
Range.prototype.subtract = function(int) {
    if (2 == arguments.length &amp;&amp; !isNaN(arguments[0]) &amp;&amp; !isNaN(arguments[1])) {
        this.subtract([arguments[0], arguments[1]]);
        return this;
    }

    if (1 &lt; arguments.length) {
        for (let ai = 0; ai &lt; arguments.length; ++ai)
            this.subtract(arguments[ai]);
        return this;
    }

    let from, to;
    if (1 == arguments.length) {
        let int = arguments[0];
        if (!this.validInterval(int))
            throw new Error("Invalid call to 'subtract', the interval '" +
                int.toJSONEx() + "' is not valid");
        if (int.is(Array)) {
            from = int[0];
            to = int[1];
        }
        else {
            from = int[this.fromProp];
            to = int[this.toProp];
        }
    }
    else if (2 == arguments.length) {
        from = arguments[0];
        to = arguments[1];
    }
    else
        throw new Error("Invalid call to 'subtract', either pass a from/to pair or an " +
            "interval object.");

    if (from > to)
        throw new Error("Invalid range passed to 'subtract', the 'from' parameter is " +
            "greater than the 'to' parameter. Make sure the parameters were passed in " +
            "the right order.");

    // If empty range, nothing to do
    if (from == to)
        return this;

    // No for or forEach loop here since some intervals may need to be removed
    let i = 0;
    while (i &lt; this.intervals.length) {
        if (from &lt; this.to(i)) {
            if (to &lt;= this.from(i))
                break;  // nothing to do

            if (from > this.from(i)) {
                if (to >= this.to(i))
                    this.intervals[i][this.toProp] = from;
                else {
                    // Gotta partition this interval
                    let nint = this.intervals[i].clone();
                    nint[this.fromProp] = to;
                    nint[this.toProp] = this.to(i);
                    this.intervals[i][this.toProp] = from;
                    this.intervals.splice(i + 1, 0, nint);
                    return this;
                }
            }
            else if (to >= this.to(i)) {
                this.intervals.splice(i, 1);
                continue;
            }
            else {
                this.intervals[i][this.fromProp] = to;
                break;
            }
        }
        ++i;

    }   // while

    return this;
};

/**
 * Combines one or more ranges with this range.
 * @param range Range to be combined.
 * @returns {Range} Returns the range to allow method chaining.
 */
Range.prototype.combine = function (range) {
    if (1 &lt; arguments.length) {
        for (let ai = 0; ai &lt; arguments.length; ++ai)
            this.combine(arguments[ai]);
        return this;
    }

    if (!range || !range.is(Range))
        throw new Error("Invalid call to 'combine', one or more arguments are not " +
            "valid 'Range' objects.");
    this.add.apply(this, range.intervals);

    return this;
};

/**
 * Excludes one or more ranges from this range.
 * @param range Range to be excluded.
 * @returns {Range} Returns the range to allow method chaining.
 */
Range.prototype.exclude = function (range) {
    if (1 &lt; arguments.length) {
        for (let ai = 0; ai &lt; arguments.length; ++ai)
            this.exclude(arguments[ai]);
        return this;
    }

    if (!range || !range.is(Range))
        throw new Error("Invalid call to 'exclude', one or more arguments are not " +
            "valid 'Range' objects.");
    this.subtract.apply(this, range.intervals);

    return this;
};

/**
 * Determines whether the two ranges are equivalent.
 * @param range Range to compare with.
 * @returns {boolean} True if the two ranges are equivalent.
 */
Range.prototype.same = function (range) {
    if (range.is(Array)) {
        if (range.length != this.intervals.length)
            return false;

        for (let i = 0; i &lt; range.length; ++i) {
            if (range[i].is(Array)) {
                if (range[i][0] != this.from(i) || range[i][1] != this.to(i))
                    return false;
            }
            else if (
                range[i][this.fromProp] != this.from(i) ||
                range[i][this.toProp] != this.to(i)
            )
                return false;
        }
        return true;
    }

    if (!range.is(Range))
        throw new Error("Range.same only accepts Arrays or Range objects");

    if (range.intervals.length != this.intervals.length)
        return false;

    for (let i = 0; i &lt; this.intervals.length; ++i) {
        if (this.from(i) != range.from(i) || this.to(i) != range.to(i))
            return false;
    }

    return true;
};


/**
 * Specialized &lt;tt>Range&lt;/tt> to use arrays, the first element of the array holds the
 * beginning of the range, the second element holds the end. See {@link Range} for
 * details on member functions of this class.
 * @constructor
 * @augments Range
 */
function ArrayRange() {
    Range.call(this, 0, 1);
}

ArrayRange.prototype = Range.prototype;

module.exports = {
    ArrayRange: ArrayRange,
    Range: Range
};</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon Apr 02 2018 17:55:42 GMT-0400 (EDT) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
